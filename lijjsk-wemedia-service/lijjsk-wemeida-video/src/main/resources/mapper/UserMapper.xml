<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lijjsk.video.mapper.UserMapper">
    <resultMap id="UserResultMap" type="com.lijjsk.model.wemedia.user.pojos.User">
        <!--column表示数据库查询结果集中的列名或别名-->
        <!--property表示对应于实体类中的属性名-->
        <id column="userId" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="age" property="age"/>
        <result column="sex" property="sex"/>
        <result column="signature" property="signature"/>
        <result column="profile_photo" property="profilePhoto"/>
        <result column="phone" property="phone"/>
        <result column="email" property="email"/>
        <result column="state" property="state"/>
        <result column="sum_followed" property="sumFollowed"/>
        <result column="sum_following" property="sumFollowing"/>
        <result column="is_secret" property="isSecret"/>
        <collection property="identitySet" resultMap="identityResultMap"/>
    </resultMap>

    <resultMap id="identityResultMap" type="com.lijjsk.model.wemedia.user.pojos.Identity">
        <id column="roleId" property="id"/>
        <result column="name" property="name"/>
    </resultMap>
    <resultMap id="userPasswordResultMap" type="com.lijjsk.model.wemedia.user.pojos.User">
        <result column="password" property="password" />
    </resultMap>
    <select id="selectUserByUsername" resultMap="UserResultMap" resultType="com.lijjsk.model.wemedia.user.pojos.User">
        select u.id as userId,
               u.username,
               u.password,
               u.age,
               u.sex,
               u.signature,
               u.profile_photo,
               u.phone,
               u.email,
               u.state,
               u.sum_followed,
               u.sum_following,
               u.is_secret,
               i.id as roleId,
               i.name
        FROM user u
                 left join user_identity ui on u.id = ui.user_id
                 left join identity i on ui.identity_id = i.id
        where u.username = #{name}
    </select>
    <select id="selectUserPasswordById" resultType="java.lang.String">
        select user.password
        from user
        where user.id = #{userId}
    </select>

</mapper>
